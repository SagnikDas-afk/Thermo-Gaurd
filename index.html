<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermo Guard - Environmental Health Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid rgb(226, 232, 240);
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .gradient-text {
            background: linear-gradient(to right, rgb(15, 23, 42), rgb(29, 78, 216));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            height: 2.5rem;
            padding: 0 1rem;
        }

        .btn-primary {
            background-color: rgb(37, 99, 235);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: rgb(29, 78, 216);
        }

        .btn-secondary {
            background-color: rgb(226, 232, 240);
            color: rgb(30, 41, 59);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: rgb(203, 213, 225);
        }

        .btn-success {
            background-color: rgb(34, 197, 94);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background-color: rgb(22, 163, 74);
        }

        .btn-danger {
            background-color: rgb(239, 68, 68);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background-color: rgb(220, 38, 38);
        }

        .btn:disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .input {
            display: flex;
            height: 2.5rem;
            width: 100%;
            border-radius: 0.5rem;
            border: 1px solid rgb(226, 232, 240);
            background-color: white;
            padding: 0 0.75rem;
            font-size: 0.875rem;
        }

        .input:focus {
            outline: none;
            border-color: rgb(37, 99, 235);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        .alert {
            width: 100%;
            border-radius: 0.5rem;
            border: 1px solid;
            padding: 1rem;
        }

        .alert-info {
            background-color: rgb(239, 246, 255);
            border-color: rgb(191, 219, 254);
            color: rgb(30, 64, 175);
        }

        .alert-success {
            background-color: rgb(240, 253, 244);
            border-color: rgb(187, 247, 208);
            color: rgb(22, 101, 52);
        }

        .alert-warning {
            background-color: rgb(254, 252, 232);
            border-color: rgb(254, 240, 138);
            color: rgb(146, 64, 14);
        }

        .alert-error {
            background-color: rgb(254, 242, 242);
            border-color: rgb(254, 202, 202);
            color: rgb(153, 27, 27);
        }

        .hidden {
            display: none;
        }

        .loading {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .profile-pic {
            width: 8rem;
            height: 8rem;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            background-color: rgb(241, 245, 249);
        }

        .toast {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 50;
            min-width: 300px;
        }

        .modal {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            padding: 1rem;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50">
    <!-- Toast Messages -->
    <div id="toast" class="toast hidden">
        <div class="alert flex items-center space-x-2 shadow-lg">
            <span id="toast-text"></span>
            <button onclick="hideToast()" class="text-xl font-bold">×</button>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="modal hidden">
        <div class="card max-w-md w-full p-6 text-center">
            <h3 id="alertTitle" class="text-2xl font-bold mb-4"></h3>
            <div class="space-y-4">
                <p id="alertMessage" class="text-lg text-slate-700"></p>
                <button onclick="hideAlert()" class="btn btn-primary w-full">Dismiss</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-sm shadow-md py-4">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <svg class="w-8 h-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
                <span class="font-bold text-lg text-slate-900">Thermo Guard</span>
            </div>
            <nav class="flex space-x-4">
                <button onclick="switchView('dashboard-view')" class="btn btn-secondary">
                    <svg class="w-4 h-4 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/>
                        <rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/>
                    </svg>
                    Dashboard
                </button>
                <button onclick="switchView('location-view')" class="btn btn-secondary">
                    <svg class="w-4 h-4 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                    Location
                </button>
                <button onclick="switchView('travel-view')" class="btn btn-secondary">
                    <svg class="w-4 h-4 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/>
                        <circle cx="12" cy="12" r="4"/>
                    </svg>
                    Travel Mode
                </button>
                <button onclick="switchView('profile-view')" class="btn btn-secondary">
                    <svg class="w-4 h-4 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                    </svg>
                    Profile
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-8">
        <!-- Dashboard View -->
        <div id="dashboard-view" class="max-w-4xl mx-auto space-y-8">
            <div class="text-center space-y-2">
                <h1 class="text-4xl font-bold gradient-text">Environmental Advisor</h1>
                <p class="text-slate-600">A personal dashboard to monitor your environment and well-being.</p>
            </div>

            <!-- Simulation Controls -->
            <div class="card p-6">
                <h2 class="text-2xl font-semibold text-slate-800 mb-4">Simulator Controls</h2>
                <div class="flex space-x-4 mb-4">
                    <button id="startBtn" onclick="startSimulation()" class="btn btn-success flex-1 font-medium py-3 px-6" disabled>
                        Start Simulation
                    </button>
                    <button id="stopBtn" onclick="stopSimulation()" class="btn btn-danger flex-1 font-medium py-3 px-6" disabled>
                        Stop Simulation
                    </button>
                </div>
                <div id="statusMessage" class="alert alert-info font-medium text-center">
                    <p>Ready to start simulation. Complete your profile first.</p>
                </div>
            </div>

            <!-- Current Readings and Location -->
            <div class="grid md:grid-cols-2 gap-6">
                <div class="card p-6 flex flex-col items-center justify-center text-center">
                    <h3 class="text-2xl font-semibold text-blue-600 mb-4">Current Readings</h3>
                    <div class="p-4 flex flex-col space-y-4">
                        <p id="currentTemp" class="text-5xl font-bold text-slate-800">--°C</p>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                                </svg>
                                <span id="currentHumidity" class="text-sm text-slate-600">Humidity: --%</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <rect width="16" height="20" x="4" y="2" rx="2"/>
                                    <path d="M8 6h8M8 10h8M8 14h8M8 18h8"/>
                                </svg>
                                <span id="currentPressure" class="text-sm text-slate-600">Pressure: --mb</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card p-6">
                    <div class="flex flex-col space-y-1.5 p-6 pb-4">
                        <h3 class="text-2xl font-semibold leading-none tracking-tight text-slate-900 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path d="M12 16s-6-5.83-6-10a6 6 0 0 1 12 0c0 4.17-6 10-6 10z"/>
                                <circle cx="12" cy="10" r="3"/>
                            </svg>
                            Location
                        </h3>
                    </div>
                    <div class="p-6 pt-0 space-y-4">
                        <div id="locationInput" class="space-y-2 hidden">
                            <input id="manualLocation" type="text" placeholder="Enter location name or coordinates" class="input">
                            <div class="flex space-x-2">
                                <button onclick="setManualLocation()" class="btn btn-primary flex-1">Set Location</button>
                                <button onclick="openGoogleMaps()" class="btn btn-secondary flex-1">Use Google Maps</button>
                            </div>
                        </div>
                        <div id="locationStatus" class="space-y-2">
                            <div class="alert alert-info">
                                <p id="locationMessage">Location services are not enabled.</p>
                            </div>
                            <button onclick="requestLocation()" class="btn btn-primary w-full">Enable Location Services</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comfort Analysis -->
            <div class="card p-6">
                <h2 class="text-2xl font-semibold text-slate-800 mb-4">Comfort Analysis</h2>
                <div class="space-y-4">
                    <div id="comfortZone" class="alert alert-success font-medium text-center">
                        <p>Collecting data to establish your comfort zone.</p>
                    </div>
                    <div id="personalScore" class="alert alert-info font-medium text-center hidden">
                        <div class="space-y-2">
                            <p>Personal Comfort Score: <span class="font-bold text-2xl" id="scoreValue">--/100</span></p>
                            <p class="text-sm" id="scoreAnalysis">Complete your profile and start simulation for analysis.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="profile-view" class="max-w-4xl mx-auto space-y-8 hidden">
            <div class="text-center space-y-2">
                <h1 class="text-4xl font-bold gradient-text">My Profile</h1>
                <p class="text-slate-600">Update your personal information to get personalized recommendations.</p>
            </div>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="md:col-span-1">
                    <div class="card">
                        <div class="flex flex-col space-y-1.5 p-6 pb-4">
                            <h3 class="text-2xl font-semibold leading-none tracking-tight text-slate-900">Profile Picture</h3>
                        </div>
                        <div class="p-6 pt-0 flex flex-col items-center gap-4">
                            <div class="profile-pic">
                                <img id="profileImage" src="" alt="Profile" class="w-full h-full object-cover hidden">
                                <div id="profilePlaceholder" class="w-full h-full flex items-center justify-center">
                                    <svg class="w-16 h-16 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                                    </svg>
                                </div>
                            </div>
                            <input type="file" id="profilePictureInput" accept="image/*" class="hidden" onchange="handleProfilePicture(event)">
                            <label for="profilePictureInput" class="btn btn-primary cursor-pointer">
                                <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>
                                </svg>
                                Upload Image
                            </label>
                        </div>
                    </div>
                </div>
                <div class="md:col-span-2">
                    <div class="card p-6">
                        <div class="flex flex-col space-y-1.5 p-6 pb-4">
                            <h3 class="text-2xl font-semibold leading-none tracking-tight text-slate-900">Personal Details</h3>
                        </div>
                        <div class="p-6 pt-0 space-y-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm font-medium leading-none">Name</label>
                                    <input id="profileName" type="text" placeholder="Your Name" class="input mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Email</label>
                                    <input id="profileEmail" type="email" placeholder="your.email@example.com" class="input mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Phone Number</label>
                                    <input id="profilePhone" type="tel" placeholder="123-456-7890" class="input mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Age</label>
                                    <input id="profileAge" type="number" placeholder="e.g. 30" class="input mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Gender</label>
                                    <select id="profileGender" class="input select mt-1">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Height (cm)</label>
                                    <input id="profileHeight" type="number" placeholder="e.g. 175" class="input mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Weight (kg)</label>
                                    <input id="profileWeight" type="number" placeholder="e.g. 70" class="input mt-1">
                                </div>
                            </div>
                            <button onclick="saveProfile()" class="btn btn-primary w-full flex justify-center items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
                                </svg>
                                <span>Save Profile</span>
                            </button>
                        </div>
                    </div>

                    <!-- Child Analysis Section -->
                    <div class="card p-6 mt-6">
                        <div class="flex flex-col space-y-1.5 p-6 pb-4">
                            <h3 class="text-2xl font-semibold leading-none tracking-tight text-slate-900 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                                    <line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/>
                                </svg>
                                Child Health Analysis
                            </h3>
                        </div>
                        <div class="p-6 pt-0 space-y-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm font-medium leading-none">Height (cm)</label>
                                    <input id="childHeight" type="number" placeholder="e.g. 120" class="input mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Weight (kg)</label>
                                    <input id="childWeight" type="number" placeholder="e.g. 25" class="input mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Age (years)</label>
                                    <input id="childAge" type="number" placeholder="e.g. 7" class="input mt-1">
                                </div>
                                <div>
                                    <label class="text-sm font-medium leading-none">Gender</label>
                                    <select id="childGender" class="input select mt-1">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                            </div>
                            <button onclick="analyzeChild()" class="btn btn-primary w-full">Analyze</button>
                            <div id="childWarning" class="alert alert-warning hidden">
                                <p>Please start the simulation on the dashboard to get real-time environmental data for the analysis.</p>
                            </div>
                            <div id="childResults" class="space-y-4 mt-4 hidden">
                                <div class="p-4 bg-green-50 rounded-lg">
                                    <p class="text-lg font-semibold text-green-700">Estimated BMR</p>
                                    <p id="childBMR" class="text-green-800"></p>
                                </div>
                                <div class="p-4 bg-blue-50 rounded-lg">
                                    <p class="text-lg font-semibold text-blue-700">Hydration Needs</p>
                                    <p id="childHydration" class="text-blue-800"></p>
                                </div>
                                <div class="p-4 bg-purple-50 rounded-lg">
                                    <p class="text-lg font-semibold text-purple-700">Comfort & Temperature</p>
                                    <p id="childComfort" class="text-purple-800">20-22°C</p>
                                    <p id="childAnalysis" class="text-slate-600 mt-2"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location View -->
        <div id="location-view" class="max-w-4xl mx-auto space-y-8 hidden">
            <div class="text-center space-y-2">
                <h1 class="text-4xl font-bold gradient-text">Location & Historical Data</h1>
                <p id="locationInfo" class="text-slate-600">Please set location</p>
            </div>
            <div class="card p-6">
                <h2 class="text-2xl font-semibold text-slate-800 mb-4">Geographical Data Comparison</h2>
                <button id="fetchHistoricalBtn" onclick="fetchHistoricalData()" class="btn btn-primary w-full font-medium py-2 px-4 mb-4" disabled>
                    Show Historical Data for Your Location
                </button>
                <div id="locationRequired" class="alert alert-warning mb-4">
                    <p>Please set your location in the Dashboard first to access historical weather data.</p>
                </div>
                <div id="historicalData" class="alert alert-success font-medium mb-6 hidden">
                    <p></p>
                </div>
            </div>

            <div id="detailedReport" class="space-y-6 hidden">
                <div class="card p-6">
                    <h2 class="text-2xl font-semibold text-slate-800 mb-6 text-center">5-Year Climate Summary</h2>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-3xl font-bold text-blue-700 mb-2">28-32°C</div>
                            <div class="text-slate-600">Average Temperature Range</div>
                        </div>
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-3xl font-bold text-blue-700 mb-2">50-60%</div>
                            <div class="text-slate-600">Average Humidity Range</div>
                        </div>
                        <div class="text-center p-4 bg-blue-50 rounded-lg">
                            <div class="text-3xl font-bold text-blue-700 mb-2">995-1005mb</div>
                            <div class="text-slate-600">Average Pressure Range</div>
                        </div>
                    </div>
                </div>
                <div class="card p-6">
                    <h2 class="text-2xl font-semibold text-slate-800 mb-4">Biometric and Hydration Analysis</h2>
                    <div class="space-y-4">
                        <p id="biometricAnalysis" class="text-slate-600">Complete your profile and start simulation for personalized analysis.</p>
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <p class="text-lg font-semibold text-blue-700">Hydration Recommendation</p>
                            <p id="hydrationRec" class="text-slate-600">Complete your profile to get personalized hydration recommendations.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Travel View -->
        <div id="travel-view" class="max-w-4xl mx-auto space-y-8 hidden">
            <div class="text-center space-y-2">
                <h1 class="text-4xl font-bold gradient-text">Travel Mode</h1>
                <p class="text-slate-600">Get personalized travel advice based on your destination's weather.</p>
            </div>
            <div class="card p-6">
                <h2 class="text-2xl font-semibold text-slate-800 mb-4">Travel Destination</h2>
                <div class="space-y-4">
                    <input id="travelLocationInput" type="text" placeholder="Enter travel destination" class="input">
                    <button onclick="getTravelAdvice()" class="btn btn-primary w-full">Get Travel Advice</button>
                    <div id="travelAdvice" class="alert alert-info hidden">
                        <p></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // A simple object to hold application state
        const appState = {
            isSimulationRunning: false,
            simulationInterval: null,
            currentReadings: {
                temp: null,
                humidity: null,
                pressure: null
            },
            userProfile: {
                isComplete: false,
                name: '',
                email: '',
                phone: '',
                age: null,
                gender: '',
                height: null,
                weight: null
            },
            location: null,
            travelLocation: null
        };

        // --- UI Control Functions ---
        function switchView(viewId) {
            const views = document.querySelectorAll('#dashboard-view, #profile-view, #location-view, #travel-view');
            views.forEach(view => {
                view.classList.add('hidden');
            });
            const activeView = document.getElementById(viewId);
            if (activeView) {
                activeView.classList.remove('hidden');
            }
        }

        function showAlert(title, message) {
            document.getElementById('alertTitle').innerText = title;
            document.getElementById('alertMessage').innerText = message;
            document.getElementById('alertModal').classList.remove('hidden');
        }

        function hideAlert() {
            document.getElementById('alertModal').classList.add('hidden');
        }

        function showToast(message, type = 'alert-info') {
            const toast = document.getElementById('toast');
            const toastText = document.getElementById('toast-text');
            const alertDiv = toast.querySelector('.alert');
            toastText.innerText = message;
            alertDiv.className = `alert flex items-center space-x-2 shadow-lg ${type}`;
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        function hideToast() {
            document.getElementById('toast').classList.add('hidden');
        }

        // --- Dashboard Functions ---
        function startSimulation() {
            if (!appState.userProfile.isComplete) {
                showAlert('Profile Incomplete', 'Please complete your profile first to start the simulation.');
                return;
            }
            appState.isSimulationRunning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('statusMessage').classList.remove('alert-info');
            document.getElementById('statusMessage').classList.add('alert-success');
            document.getElementById('statusMessage').innerHTML = '<p>Simulation started. Monitoring environment...</p>';

            if (appState.simulationInterval) {
                clearInterval(appState.simulationInterval);
            }
            appState.simulationInterval = setInterval(updateReadings, 2000);
        }

        function stopSimulation() {
            appState.isSimulationRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('statusMessage').classList.remove('alert-success');
            document.getElementById('statusMessage').classList.add('alert-info');
            document.getElementById('statusMessage').innerHTML = '<p>Simulation stopped. Data is no longer being collected.</p>';
            clearInterval(appState.simulationInterval);
        }

        function updateReadings() {
            // Simulating sensor data
            appState.currentReadings.temp = (Math.random() * 15) + 20; // 20-35 C
            appState.currentReadings.humidity = (Math.random() * 40) + 40; // 40-80%
            appState.currentReadings.pressure = (Math.random() * 20) + 990; // 990-1010mb

            document.getElementById('currentTemp').innerText = `${appState.currentReadings.temp.toFixed(1)}°C`;
            document.getElementById('currentHumidity').innerText = `Humidity: ${appState.currentReadings.humidity.toFixed(0)}%`;
            document.getElementById('currentPressure').innerText = `Pressure: ${appState.currentReadings.pressure.toFixed(0)}mb`;

            // Update comfort score
            const tempScore = Math.max(0, 100 - Math.abs(appState.currentReadings.temp - 22) * 8);
            const humidityScore = Math.max(0, 100 - Math.abs(appState.currentReadings.humidity - 50) * 1.5);
            const overallScore = ((tempScore + humidityScore) / 2).toFixed(0);

            document.getElementById('scoreValue').innerText = `${overallScore}/100`;
            document.getElementById('personalScore').classList.remove('hidden');
            
            // Comfort zone analysis
            const comfortZone = document.getElementById('comfortZone');
            if (overallScore > 80) {
                comfortZone.className = 'alert alert-success font-medium text-center';
                comfortZone.innerHTML = '<p>You are in your optimal comfort zone!</p>';
            } else if (overallScore > 60) {
                comfortZone.className = 'alert alert-warning font-medium text-center';
                comfortZone.innerHTML = '<p>Conditions are acceptable, but not ideal.</p>';
            } else {
                comfortZone.className = 'alert alert-error font-medium text-center';
                comfortZone.innerHTML = '<p>Conditions are outside your comfort range. Adjust as needed.</p>';
            }

            updateBiometricAnalysis();
        }

        // --- Profile Functions ---
        function saveProfile() {
            appState.userProfile.name = document.getElementById('profileName').value.trim();
            appState.userProfile.email = document.getElementById('profileEmail').value.trim();
            appState.userProfile.phone = document.getElementById('profilePhone').value.trim();
            appState.userProfile.age = document.getElementById('profileAge').value.trim();
            appState.userProfile.gender = document.getElementById('profileGender').value;
            appState.userProfile.height = document.getElementById('profileHeight').value.trim();
            appState.userProfile.weight = document.getElementById('profileWeight').value.trim();

            const requiredFields = [appState.userProfile.name, appState.userProfile.age, appState.userProfile.height, appState.userProfile.weight];
            const profileComplete = requiredFields.every(field => field !== '' && field !== null);

            appState.userProfile.isComplete = profileComplete;

            if (appState.userProfile.isComplete) {
                document.getElementById('startBtn').disabled = false;
                document.getElementById('statusMessage').classList.remove('hidden');
                document.getElementById('statusMessage').innerHTML = '<p>Profile saved. You can now start the simulation.</p>';
                showToast('Profile saved successfully!', 'alert-success');
            } else {
                showAlert('Missing Information', 'Please fill in all profile fields to enable the simulation.');
            }
        }

        function handleProfilePicture(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profileImage').src = e.target.result;
                    document.getElementById('profileImage').classList.remove('hidden');
                    document.getElementById('profilePlaceholder').classList.add('hidden');
                }
                reader.readAsDataURL(file);
            }
        }

        function analyzeChild() {
            if (!appState.isSimulationRunning) {
                document.getElementById('childWarning').classList.remove('hidden');
                document.getElementById('childResults').classList.add('hidden');
                return;
            }

            document.getElementById('childWarning').classList.add('hidden');

            const childAge = parseFloat(document.getElementById('childAge').value);
            const childHeight = parseFloat(document.getElementById('childHeight').value);
            const childWeight = parseFloat(document.getElementById('childWeight').value);
            const childGender = document.getElementById('childGender').value;

            if (isNaN(childAge) || isNaN(childHeight) || isNaN(childWeight)) {
                showAlert('Invalid Input', 'Please enter valid numbers for child\'s age, height, and weight.');
                return;
            }

            // Mifflin-St Jeor Equation for BMR (simplified)
            let bmr = 0;
            if (childGender === 'male') {
                bmr = (10 * childWeight) + (6.25 * childHeight) - (5 * childAge) + 5;
            } else {
                bmr = (10 * childWeight) + (6.25 * childHeight) - (5 * childAge) - 161;
            }
            document.getElementById('childBMR').innerText = `${bmr.toFixed(0)} kcal/day`;

            // Hydration Needs (simplified, based on age and activity)
            let hydration = childAge * 70; // mL per day
            if (appState.currentReadings.temp > 25) {
                hydration += (appState.currentReadings.temp - 25) * 50; // Add 50mL for every degree over 25C
            }
            document.getElementById('childHydration').innerText = `${(hydration / 1000).toFixed(1)} L/day`;

            // Comfort analysis for child
            let childComfortTemp = (childAge < 5) ? '22-25°C' : '20-22°C';
            document.getElementById('childComfort').innerText = childComfortTemp;
            let analysis = '';
            if (appState.currentReadings.temp > 28) {
                analysis = 'Current temperature is high for a child. Consider cooling the environment.';
            } else if (appState.currentReadings.temp < 20) {
                analysis = 'Current temperature is low for a child. Ensure they are dressed warmly.';
            } else {
                analysis = 'Current temperature is within a comfortable range.';
            }
            document.getElementById('childAnalysis').innerText = analysis;

            document.getElementById('childResults').classList.remove('hidden');
        }

        // --- Location Functions ---
        function requestLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    appState.location = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                    document.getElementById('locationMessage').innerText = `Location set to: Lat ${appState.location.latitude.toFixed(2)}, Lon ${appState.location.longitude.toFixed(2)}`;
                    document.getElementById('locationStatus').innerHTML = `<div class="alert alert-success"><p>${document.getElementById('locationMessage').innerText}</p></div>`;
                    document.getElementById('fetchHistoricalBtn').disabled = false;
                    document.getElementById('locationInfo').innerText = `Current location: Lat ${appState.location.latitude.toFixed(2)}, Lon ${appState.location.longitude.toFixed(2)}`;
                    showToast('Location services enabled!', 'alert-success');
                }, error => {
                    showAlert('Geolocation Error', 'Unable to retrieve your location. Please check your browser settings.');
                    document.getElementById('locationStatus').classList.add('hidden');
                    document.getElementById('locationInput').classList.remove('hidden');
                });
            } else {
                showAlert('Geolocation Not Supported', 'Your browser does not support Geolocation.');
                document.getElementById('locationStatus').classList.add('hidden');
                document.getElementById('locationInput').classList.remove('hidden');
            }
        }

        function setManualLocation() {
            // Placeholder for manual location setting
            const manualLoc = document.getElementById('manualLocation').value.trim();
            if (manualLoc) {
                appState.location = manualLoc;
                document.getElementById('locationInfo').innerText = `Current location: ${appState.location}`;
                document.getElementById('locationStatus').classList.remove('hidden');
                document.getElementById('locationStatus').innerHTML = `<div class="alert alert-success"><p>Location set to: ${manualLoc}</p></div>`;
                document.getElementById('locationInput').classList.add('hidden');
                document.getElementById('fetchHistoricalBtn').disabled = false;
                showToast('Manual location set!', 'alert-success');
            } else {
                showToast('Please enter a location.', 'alert-error');
            }
        }

        function openGoogleMaps() {
            let query = '';
            if (appState.location && typeof appState.location === 'object') {
                query = `${appState.location.latitude},${appState.location.longitude}`;
            } else if (appState.location) {
                query = appState.location;
            } else {
                query = '';
            }
            window.open(`https://www.google.com/maps/place/?q=${encodeURIComponent(query)}`, '_blank');
        }

        function fetchHistoricalData() {
            if (appState.location) {
                document.getElementById('locationRequired').classList.add('hidden');
                document.getElementById('historicalData').classList.remove('hidden');
                document.getElementById('historicalData').innerHTML = '<p>Simulating historical data retrieval...</p>';
                document.getElementById('detailedReport').classList.remove('hidden');

                setTimeout(() => {
                    const temp = `${(Math.random() * 5 + 28).toFixed(0)}-${(Math.random() * 5 + 32).toFixed(0)}°C`;
                    const humidity = `${(Math.random() * 10 + 50).toFixed(0)}-${(Math.random() * 10 + 60).toFixed(0)}%`;
                    const pressure = `${(Math.random() * 10 + 995).toFixed(0)}-${(Math.random() * 10 + 1005).toFixed(0)}mb`;

                    document.querySelector('#detailedReport .grid div:nth-child(1) .text-3xl').innerText = temp;
                    document.querySelector('#detailedReport .grid div:nth-child(2) .text-3xl').innerText = humidity;
                    document.querySelector('#detailedReport .grid div:nth-child(3) .text-3xl').innerText = pressure;

                    document.getElementById('historicalData').innerHTML = `<p>Historical climate summary retrieved for your location!</p>`;
                    showToast('Historical data loaded!', 'alert-success');
                }, 1500);

            } else {
                showAlert('Location Not Set', 'Please set your location on the Dashboard first.');
            }
        }

        // --- Travel Functions ---
        function getTravelAdvice() {
            const travelLocation = document.getElementById('travelLocationInput').value;
            const adviceDiv = document.getElementById('travelAdvice');

            if (!travelLocation) {
                showToast('Please enter a travel destination.', 'alert-error');
                return;
            }

            adviceDiv.classList.remove('hidden');
            adviceDiv.classList.remove('alert-info', 'alert-success', 'alert-warning');
            adviceDiv.innerHTML = '<p class="text-center"><span class="loading">...</span> Getting advice for ' + travelLocation + '...</p>';

            // Simulate fetching travel data
            setTimeout(() => {
                const temp = (Math.random() * 20) + 15;
                const advice = `The current temperature in ${travelLocation} is ${temp.toFixed(1)}°C.`;
                adviceDiv.classList.add('alert-info');
                adviceDiv.innerHTML = `<p>${advice}</p><p>Recommendation: Pack light clothing and a jacket for cooler evenings.</p>`;
                showToast('Travel advice ready!', 'alert-success');
            }, 2000);
        }

        function updateBiometricAnalysis() {
            const biometricAnalysisDiv = document.getElementById('biometricAnalysis');
            const hydrationRecDiv = document.getElementById('hydrationRec');
            
            if (appState.userProfile.isComplete && appState.currentReadings.temp !== null) {
                const age = parseFloat(appState.userProfile.age);
                const weight = parseFloat(appState.userProfile.weight);
                const height = parseFloat(appState.userProfile.height);
                const gender = appState.userProfile.gender;
                
                // Harris-Benedict Equation for BMR (simplified)
                let bmr = 0;
                if (gender === 'male') {
                    bmr = 66.5 + (13.75 * weight) + (5.003 * height) - (6.75 * age);
                } else {
                    bmr = 655.1 + (9.563 * weight) + (1.850 * height) - (4.676 * age);
                }

                // Hydration recommendation based on temp and weight
                let hydration = weight * 30; // 30-40mL per kg
                if (appState.currentReadings.temp > 25) {
                    hydration += (appState.currentReadings.temp - 25) * (weight * 0.5);
                }
                const hydrationL = (hydration / 1000).toFixed(2);
                
                biometricAnalysisDiv.innerHTML = `Your estimated Basal Metabolic Rate (BMR) is **${bmr.toFixed(0)} kcal/day**.`;
                hydrationRecDiv.innerHTML = `Based on the current environment and your profile, your daily hydration need is approximately **${hydrationL} L**.`;
            }
        }

        // Initialize the first view when the page loads
        window.onload = function() {
            switchView('dashboard-view');
        };
    </script>
</body>
</html>
